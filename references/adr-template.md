# ADR (Architecture Decision Record) 模板

## 文件命名规范

```
ADR-{序号}-{简短描述}.md
```

**示例**:
- `ADR-001-semantic-chunking-strategy.md`
- `ADR-002-fallback-parser-mechanism.md`

## ADR 存放位置

```
specs/{分支名}/decisions/
```

如果 `decisions/` 目录不存在，自动创建。

## 模板内容

```markdown
# ADR-{序号}: {标题}

**日期**: {YYYY-MM-DD}  
**状态**: {提议中 | 已采纳 | 已废弃 | 已替代}  
**关联需求**: {需求编号或"无"}

## 背景

{描述导致这个决策的背景和问题}

为什么需要做这个决策？当前遇到了什么问题？

## 决策

{描述做出的决策}

我们决定采用 {方案}，因为 {原因}。

### 具体实现

{如果适用，描述具体的实现方式}

## 备选方案

### 方案 A: {名称}

{描述}

**优点**:
- 

**缺点**:
- 

### 方案 B: {名称}

{描述}

**优点**:
- 

**缺点**:
- 

## 影响

### 正面影响

- 

### 负面影响/风险

- 

### 需要变更的文档/代码

- [ ] spec.md - {具体章节}
- [ ] data-model.md - {具体内容}
- [ ] api.md - {具体内容}

## 参考资料

- {相关链接或文档}
```

## 状态说明

| 状态 | 含义 |
|------|------|
| 提议中 | 决策正在讨论中，尚未最终确定 |
| 已采纳 | 决策已被接受并正在/已经实施 |
| 已废弃 | 决策不再适用，但保留记录 |
| 已替代 | 决策被新的 ADR 替代，需标注新 ADR 编号 |

## 何时创建 ADR

**必须创建**:
- 重大架构变更
- 技术栈选择
- 数据模型重构
- 跨模块的行为变更

**建议创建**:
- API 设计变更
- 性能优化策略选择
- 第三方服务集成决策

**可选创建**:
- 重要 Bug 修复（如果揭示了设计问题）
- 编码规范变更

## ADR 编号管理

1. 查看 `specs/{分支名}/decisions/` 目录下现有的 ADR
2. 取最大序号 + 1 作为新 ADR 的序号
3. 如果目录为空，从 001 开始

## 示例 ADR

```markdown
# ADR-001: 采用 Docling 作为主要文档解析器

**日期**: 2026-01-15  
**状态**: 已采纳  
**关联需求**: REQ-001-01, REQ-001-02

## 背景

当前项目需要处理多种文档格式（PDF、DOCX、XLSX 等），之前使用各种独立的解析库，存在以下问题：
1. 维护成本高，每种格式需要单独的解析逻辑
2. 输出格式不统一，后续处理困难
3. 部分格式解析质量不佳

## 决策

采用 Docling 作为主要文档解析器，同时保留原有解析器作为降级策略。

### 具体实现

1. Docling 作为第一选择解析器
2. 解析失败时自动降级到对应格式的专用解析器
3. 设计统一的输出数据结构 `UnifiedDocument`

## 备选方案

### 方案 A: 继续使用独立解析器

**优点**:
- 无需学习新库
- 现有代码可复用

**缺点**:
- 维护成本高
- 输出格式不统一

### 方案 B: 仅使用 Docling

**优点**:
- 代码简洁
- 统一的解析流程

**缺点**:
- 某些格式支持不完善
- 无降级方案

## 影响

### 正面影响
- 统一的文档处理流程
- 更好的表格和图片提取
- 减少维护成本

### 负面影响/风险
- 引入新依赖
- 需要学习 Docling API
- 可能存在未知的边界情况

### 需要变更的文档/代码
- [x] spec.md - 文档处理章节
- [x] data-model.md - UnifiedDocument 结构
- [x] api.md - 解析接口响应格式

## 参考资料
- Docling 官方文档: https://ds4sd.github.io/docling/
```
